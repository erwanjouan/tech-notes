# Maven

- [Developpez.com: Apprendre Apache Maven, l'outil de gestion et d'automatisation de production des projets logiciels](https://java.developpez.com/tutoriels/java/maven-book/)

## Build lifecycle 

- [Introduction to the Build Lifecycle](https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)

- 3 built-in lifecycle
  - default
  - clean
  - site


### Build phases of lifecycles

#### Clean lifecylce

| Phase      | Description                                                   |
|------------|---------------------------------------------------------------|
| pre-clean  | execute processes needed prior to the actual project cleaning |
| clean      | remove all files generated by the previous build              |
| post-clean | execute processes needed to finalize the project cleaning     |

#### Default lifecycle

| Phase                   | Description                                                                                                                                             |
|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| clean	                  | remove all files generated by the previous build                                                                                                        |
| validate                | validate the project is correct and all necessary information is available.                                                                             | 
| initialize              | initialize build state, e.g. set properties or create directories.                                                                                      | 
| generate-sources        | generate any source code for inclusion in compilation.                                                                                                  | 
| process-sources         | process the source code, for example to filter any values.                                                                                              | 
| generate-resources      | generate resources for inclusion in the package.                                                                                                        | 
| process-resources       | copy and process the resources into the destination directory, ready for packaging.                                                                     | 
| compile                 | compile the source code of the project.                                                                                                                 | 
| process-classes         | post-process the generated files from compilation, for example to do bytecode enhancement on Java classes.                                              | 
| generate-test-sources   | generate any test source code for inclusion in compilation.                                                                                             | 
| process-test-sources    | process the test source code, for example to filter any values.                                                                                         | 
| generate-test-resources | create resources for testing.                                                                                                                           | 
| process-test-resources  | copy and process the resources into the test destination directory.                                                                                     | 
| test-compile            | compile the test source code into the test destination directory                                                                                        | 
| process-test-classes    | post-process the generated files from test compilation, for example to do bytecode enhancement on Java classes.                                         | 
| test                    | run tests using a suitable unit testing framework. These tests should not require the code be packaged or deployed.                                     | 
| prepare-package         | perform any operations necessary to prepare a package before the actual packaging. This often results in an unpacked, processed version of the package. | 
| package                 | take the compiled code and package it in its distributable format, such as a JAR.                                                                       | 
| pre-integration-test    | perform actions required before integration tests are executed. This may involve things such as setting up the required environment.                    | 
| integration-test        | process and deploy the package if necessary into an environment where integration tests can be run.                                                     | 
| post-integration-test   | perform actions required after integration tests have been executed. This may including cleaning up the environment.                                    | 
| verify                  | run any checks to verify the package is valid and meets quality criteria.                                                                               | 
| install                 | install the package into the local repository, for use as a dependency in other projects locally.                                                       | 
| deploy                  | done in an integration or release environment, copies the final package to the remote repository for sharing with other developers and projects.        |

#### Site Lifecycle

| Phase       | Description                                                                                   |
|-------------|-----------------------------------------------------------------------------------------------|
| clean       | remove all files generated by the previous build                                              |
| pre-site    | 	execute processes needed prior to the actual project site generation                         |
| site        | 	generate the project's site documentation                                                    |
| post-site   | 	execute processes needed to finalize the site generation, and to prepare for site deployment |
| site-deploy | 	deploy the generated site documentation to the specified web server                          |


#### Goal binding

- A plugin goal represents a specific task (finer than a build phase) which contributes to the building and managing of a project. It may be bound to zero or more build phases.

### Packaging

- jar (default), war, ear and pom
- Each packaging contains a list of goals to bind to a particular phase. Ex for jar

| Phase   | plugin:goal for the jar packaging |
|---------|-----------------------------------|
| ...     | ...                               |
| test    | surefire:test                     |
| package | jar:jar                           |
| install | install:install                   |
| ...     | ...                               |


## Plugins

- Plugins are artifacts that provide goals to Maven
- Furthermore, a plugin may have one or more goals wherein each goal represents a capability of that plugin
- The goals that are configured will be added to the goals already bound to the lifecycle from the packaging selected
- you can use the ```<executions>``` element to gain more control over the order of particular goals.

```xml
 <plugin>
   <groupId>com.mycompany.example</groupId>
   <artifactId>display-maven-plugin</artifactId>
   <version>1.0</version>
   <executions>
     <execution>
         <id>A_label_to_distinguish_between_executions</id>
       <phase>process-test-resources</phase>
       <goals>
         <goal>time</goal>
       </goals>
     </execution>
   </executions>
 </plugin>
```

- Above, you have a goal ```display:time``` that echos the current time to the commandline, and you want it to run in the process-test-resources phase to indicate when the tests were started.
- 